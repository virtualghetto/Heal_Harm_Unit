#textdomain wesnoth-Heal_Harm_Unit
[textdomain]
    name="wesnoth-Heal_Harm_Unit"
    path="data/add-ons/Heal_Harm_Unit/translations"
[/textdomain]

[modification]
    id=Mod_Heal_Harm_Unit
    name= _ "Mod Heal/Harm units"
    description= _ "A modification to heal or harm units."
    require_modification=no
    type=hybrid

    [event]
        name=select
        first_time_only=no
        [filter]
            x,y=$x1,$y1
            [not]
                id=$hhu.debbie_actor[0].id
            [/not]
            [filter_side]
                controller=human
            [/filter_side]
        [/filter]
        [store_unit]
            [filter]
                x,y=$x1,$y1
                id=$unit.id
            [/filter]
            mode=always_clear
            variable=hhu.debbie_actor
        [/store_unit]
    [/event]

    [event]
        name=turn refresh
        first_time_only=yes

        {VARIABLE mod_give_xp yes}

        [store_unit]
            [filter]
                [filter_side]
                    controller=human
                [/filter_side]
            [/filter]
            mode=always_clear
            variable=hhu.debbie_actor
        [/store_unit]

        [set_menu_item]
            id=mod_turn_off_xp
            description= _ "Turn Off Harm XP (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                {VARIABLE_CONDITIONAL mod_give_xp boolean_equals yes}
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE mod_give_xp no}
            [/command]
        [/set_menu_item]

        [set_menu_item]
            id=mod_turn_on_xp
            description= _ "Turn On Harm XP (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                {VARIABLE_CONDITIONAL mod_give_xp boolean_not_equals yes}
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE mod_give_xp yes}
            [/command]
        [/set_menu_item]

        [set_menu_item]
            id=debbie_actor_menu
            description= _ "Select Healing Unit (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                    [not]
                        id=$hhu.debbie_actor[0].id
                    [/not]
                [/have_unit]
            [/show_if]
            [command]
                [store_unit]
                    [filter]
                        x,y=$x1,$y1
                        id=$unit.id
                    [/filter]
                    mode=always_clear
                    variable=hhu.debbie_actor
                [/store_unit]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=debbie_heal_menu
            description= _ "Heal Unit/Side (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                [if]
                    [have_unit]
                        x,y=$x1,$y1
                        count=1
                        search_recall_list=no
                        [and]
                            [filter_wml]
                                hitpoints=$this_unit.max_hitpoints
                            [/filter_wml]
                        [/and]
                    [/have_unit]
                    [then]
                        [heal_unit]
                            [filter]
                                side=$unit.side
                            [/filter]
                            amount=full
                            restore_attacks=no
                            restore_statuses=no
                            animate=no
                        [/heal_unit]
                        [clear_variable]
                            name=heal_amount
                        [/clear_variable]
                    [/then]
                    [else]
                        [heal_unit]
                            [filter]
                                x,y=$x1,$y1
                                id=$unit.id
                            [/filter]
                            amount=full
                            restore_attacks=no
                            restore_statuses=no
                            animate=yes
                        [/heal_unit]
                        [clear_variable]
                            name=heal_amount
                        [/clear_variable]
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=debbie_harm_menu
            description= _ "Harm/Kill Unit (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                [/have_unit]
                [and]
                    [not]
                        [have_unit]
                            x,y=$x1,$y1
                            side=$hhu.debbie_actor.side
                        [/have_unit]
                    [/not]
                [/and]
            [/show_if]
            [command]
                [if]
                    [variable]
                        name=hhu.debbie_actor.length
                        numerical_equals=0
                    [/variable]
                    [then]
                        [store_unit]
                            [filter]
                                [filter_side]
                                    controller=human
                                [/filter_side]
                            [/filter]
                            mode=always_clear
                            variable=hhu.debbie_actor
                        [/store_unit]
                    [/then]
                [/if]
                [if]
                    [not]
                        [variable]
                            name=hhu.debbie_actor.side
                            equals=$unit.side
                        [/variable]
                    [/not]
                    [then]
                        [if]
                            [variable]
                                name=unit.hitpoints
                                greater_than=1
                            [/variable]
                            [then]
                                [set_variable]
                                    name=unit.hitpoints
                                    sub=1
                                [/set_variable]
                            [/then]
                        [/if]
                        [harm_unit]
                            [filter]
                                x,y=$x1,$y1
                                id=$unit.id
                            [/filter]
                            [filter_second]
                                id=$hhu.debbie_actor.id
                            [/filter_second]
                            [primary_attack]
                            [/primary_attack]
                            [secondary_attack]
                            [/secondary_attack]
                            amount=$unit.hitpoints
                            kill=yes
                            animate=no
                            experience=$mod_give_xp
                            fire_event=$mod_give_xp
                        [/harm_unit]
                        [clear_variable]
                            name=harm_amount
                        [/clear_variable]
                    [/then]
                [/if]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=debbie_harm_side_menu
            description= _ "Harm/Kill Side (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                [/have_unit]
                [and]
                    [not]
                        [have_unit]
                            x,y=$x1,$y1
                            side=$hhu.debbie_actor.side
                        [/have_unit]
                    [/not]
                [/and]
            [/show_if]
            [command]
                [if]
                    [variable]
                        name=hhu.debbie_actor.length
                        numerical_equals=0
                    [/variable]
                    [then]
                        [store_unit]
                            [filter]
                                [filter_side]
                                    controller=human
                                [/filter_side]
                            [/filter]
                            mode=always_clear
                            variable=hhu.debbie_actor
                        [/store_unit]
                    [/then]
                [/if]
                [if]
                    [not]
                        [variable]
                            name=hhu.debbie_actor.side
                            equals=$unit.side
                        [/variable]
                    [/not]
                    [then]
                        [if]
                            [variable]
                                name=unit.hitpoints
                                greater_than=1
                            [/variable]
                            [then]
                                [harm_unit]
                                    [filter]
                                        side=$unit.side
                                    [/filter]
                                    [filter_second]
                                        id=$hhu.debbie_actor.id
                                    [/filter_second]
                                    [primary_attack]
                                    [/primary_attack]
                                    [secondary_attack]
                                    [/secondary_attack]
                                    amount=$this_unit.hitpoints
                                    kill=no
                                    animate=no
                                    experience=$mod_give_xp
                                    fire_event=$mod_give_xp
                                [/harm_unit]
                                [clear_variable]
                                    name=harm_amount
                                [/clear_variable]
                            [/then]
                            [else]
                                [harm_unit]
                                    [filter]
                                        side=$unit.side
                                    [/filter]
                                    [filter_second]
                                        id=$hhu.debbie_actor.id
                                    [/filter_second]
                                    [primary_attack]
                                    [/primary_attack]
                                    [secondary_attack]
                                    [/secondary_attack]
                                    amount=$this_unit.hitpoints
                                    kill=yes
                                    animate=no
                                    experience=$mod_give_xp
                                    fire_event=$mod_give_xp
                                [/harm_unit]
                                [clear_variable]
                                    name=harm_amount
                                [/clear_variable]
                            [/else]
                        [/if]
                    [/then]
                [/if]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_variable]
                name=mod_give_xp
            [/clear_variable]
            [clear_variable]
                name=hhu.debbie_actor
            [/clear_variable]
            [clear_menu_item]
                id=debbie_heal_menu
            [/clear_menu_item]
            [clear_menu_item]
                id=debbie_harm_menu
            [/clear_menu_item]
            [clear_menu_item]
                id=debbie_harm_side_menu
            [/clear_menu_item]
            [clear_menu_item]
                id=debbie_actor_menu
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_turn_off_xp
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_turn_on_xp
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_Invincible
    name= _ "Mod Invincible"
    description= _ "A modification to make human sides invincible."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        #        {MOD_INVINCIBLE (
        #            [filter_side]
        #                controller=human
        #            [/filter_side]
        #        ) (
        #            [filter_side]
        #                controller=ai
        #            [/filter_side]
        #        )}

        # # define MOD_INVINCIBLE FILTER SECOND_FILTER
        [event]
            name=attack
            id=mod_invincible_attack
            first_time_only=no
            [filter]
                #{FILTER}
                [filter_side]
                    controller=human
                [/filter_side]
            [/filter]
            [filter_second]
                #{SECOND_FILTER}
                [filter_side]
                    controller=ai
                [/filter_side]
            [/filter_second]
            [filter_condition]
                {VARIABLE_CONDITIONAL mod_invincible numerical_equals 1}
            [/filter_condition]
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=status
                    add=invulnerable
                [/effect]
            [/modify_unit]
            [event]
                name=attack end
                delayed_variable_substitution=yes
                [if]
                    [variable]
                        name=unit.length
                        numerical_equals=0
                    [/variable]
                    [then]
                        # Unit vanished mid-fight
                        [return][/return]
                    [/then]
                [/if]
                [modify_unit]
                    [filter]
                        id=$unit.id
                    [/filter]
                    [effect]
                        apply_to=status
                        remove=invulnerable
                    [/effect]
                [/modify_unit]
            [/event]
        [/event]
        [event]
            name=attack
            id=mod_invincible_defend
            first_time_only=no
            [filter]
                #{SECOND_FILTER}
                [filter_side]
                    controller=ai
                [/filter_side]
            [/filter]
            [filter_second]
                #{FILTER}
                [filter_side]
                    controller=human
                [/filter_side]
            [/filter_second]
            [filter_condition]
                {VARIABLE_CONDITIONAL mod_invincible numerical_equals 1}
            [/filter_condition]
            [modify_unit]
                [filter]
                    id=$second_unit.id
                [/filter]
                [effect]
                    apply_to=status
                    add=invulnerable
                [/effect]
            [/modify_unit]
            [event]
                name=attack end
                delayed_variable_substitution=yes
                [if]
                    [variable]
                        name=second_unit.length
                        numerical_equals=0
                    [/variable]
                    [then]
                        # Unit vanished mid-fight
                        [return][/return]
                    [/then]
                [/if]
                [modify_unit]
                    [filter]
                        id=$second_unit.id
                    [/filter]
                    [effect]
                        apply_to=status
                        remove=invulnerable
                    [/effect]
                [/modify_unit]
            [/event]
        [/event]
        # # enddef

        [set_menu_item]
            id=mod_invincible_on
            description= _ "Turn On Invincible (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [not]
                    {VARIABLE_CONDITIONAL mod_invincible numerical_equals 1}
                [/not]
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE mod_invincible 1}
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=mod_invincible_off
            description= _ "Turn Off Invincible (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                {VARIABLE_CONDITIONAL mod_invincible numerical_equals 1}
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE mod_invincible 0}
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_variable]
                name=mod_invincible
            [/clear_variable]
            [clear_menu_item]
                id=mod_invincible_on
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_invincible_off
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_Exploration
    name= _ "Mod Exploration"
    description= _ "A modification that allows human sides to explore the map."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_exploration_on
            description= _ "Turn On Exploration (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [not]
                    {VARIABLE_CONDITIONAL mod_exploration numerical_equals 1}
                [/not]
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE mod_exploration 1}
                [event]
                    name=moveto
                    first_time_only=no
                    id=mod_exploration_moveto
                    delayed_variable_substitution=yes
                    [filter]
                        x,y=$x1,$y1
                        [filter_side]
                            controller=human
                        [/filter_side]
                    [/filter]
                    [filter_condition]
                        {VARIABLE_CONDITIONAL mod_exploration numerical_equals 1}
                    [/filter_condition]
                    [if]
                        {VARIABLE_CONDITIONAL unit.moves less_than 2}
                        [then]
                            {MODIFY_UNIT (id=$unit.id) moves $unit.max_moves}
                        [/then]
                    [/if]
                [/event]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=mod_exploration_off
            description= _ "Turn Off Exploration (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                {VARIABLE_CONDITIONAL mod_exploration numerical_equals 1}
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE mod_exploration 0}
                [remove_event]
                    id=mod_exploration_moveto
                [/remove_event]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_variable]
                name=mod_exploration
            [/clear_variable]
            [clear_menu_item]
                id=mod_exploration_on
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_exploration_off
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_FogShroud
    name= _ "Mod Toggle Fog/Shroud"
    description= _ "A modification to toggle Fog and Shroud."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_toggle_fog
            description= _ "Toggle Fog (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                [store_side]
                    side=$side_number
                    variable=side_store_mod
                    mode=always_clear
                [/store_side]
                [if]
                    {VARIABLE_CONDITIONAL side_store_mod.fog equals no}
                    [then]
                        [modify_side]
                            side=$side_number
                            fog=yes
                        [/modify_side]
                    [/then]
                    [else]
                        [modify_side]
                            side=$side_number
                            fog=no
                        [/modify_side]
                    [/else]
                [/if]
                [redraw]
                    side=$side_number
                    clear_shroud=yes
                [/redraw]
                {CLEAR_VARIABLE side_store_mod}
            [/command]
        [/set_menu_item]

        [set_menu_item]
            id=mod_toggle_shroud
            description= _ "Toggle Shroud (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                [store_side]
                    side=$side_number
                    variable=side_store_mod
                    mode=always_clear
                [/store_side]
                [if]
                    {VARIABLE_CONDITIONAL side_store_mod.shroud equals no}
                    [then]
                        [modify_side]
                            side=$side_number
                            shroud=yes
                        [/modify_side]
                    [/then]
                    [else]
                        [modify_side]
                            side=$side_number
                            shroud=no
                        [/modify_side]
                    [/else]
                [/if]
                [redraw]
                    side=$side_number
                    clear_shroud=yes
                [/redraw]
                {CLEAR_VARIABLE side_store_mod}
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_toggle_fog
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_toggle_shroud
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

#[modification]
#    id=Mod_ShowID
#    name= _ "Mod Show ID"
#    description= _ "A modification to show unit ID and role."
#    require_modification=no
#    type=hybrid
#
#    [event]
#        name=prestart
#
#        [set_menu_item]
#            id=mod_showid
#            description= _ "Show ID (Mod)"
#            image=misc/blank-hex.png~SCALE(1,1)
#            [show_if]
#                [have_unit]
#                    x,y=$x1,$y1
#                [/have_unit]
#            [/show_if]
#            [command]
#                [message]
#                    speaker=unit
#                    message="My ID is $unit.id| and my role is $unit.role| ."
#                [/message]
#            [/command]
#        [/set_menu_item]
#
#        [event]
#            name=scenario_end
#            [clear_menu_item]
#                id=mod_showid
#            [/clear_menu_item]
#        [/event]
#    [/event]
#[/modification]

[modification]
    id=Mod_GiveGold
    name= _ "Mod Give Gold"
    description= _ "A modification to give gold."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_givegold
            description= _ "Give Gold (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                [/have_unit]
            [/show_if]
            [command]
                [message]
                    speaker=unit
                    message="How much gold to side $unit.side|?"
                    [text_input]
                        label=_"Amount:"
                        variable=gold_amount
                        text=100
                        max_length=16
                    [/text_input]
                [/message]
                [gold]
                    side=$unit.side
                    amount=$gold_amount
                [/gold]
                {CLEAR_VARIABLE gold_amount}
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_givegold
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

#[modification]
#    id=Mod_AddRemoveVillages
#    name= _ "Mod Add/Remove Villages"
#    description= _ "A modification to add/remove villages."
#    require_modification=no
#    type=hybrid
#
#    [event]
#        name=prestart
#
#        [set_menu_item]
#            id=mod_remove_village
#            description= _ "Remove Village (Mod)"
#            image=misc/blank-hex.png~SCALE(1,1)
#            [show_if]
#                [have_location]
#                    x,y=$x1,$y1
#                    terrain=*^V*
#                [/have_location]
#            [/show_if]
#            [command]
#                [terrain]
#                    terrain=^
#                    layer=overlay
#                    [and]
#                        x,y=$x1,$y1
#                    [/and]
#                [/terrain]
#            [/command]
#        [/set_menu_item]
#        [set_menu_item]
#            id=mod_add_village
#            description= _ "Add Village (Mod)"
#            image=misc/blank-hex.png~SCALE(1,1)
#            [show_if]
#                [have_location]
#                    x,y=$x1,$y1
#                    terrain=*^V*
#                    count=0
#                [/have_location]
#            [/show_if]
#            [command]
#                [terrain]
#                    terrain=^Vh
#                    layer=overlay
#                    [and]
#                        x,y=$x1,$y1
#                    [/and]
#                [/terrain]
#            [/command]
#        [/set_menu_item]
#
#        [event]
#            name=scenario_end
#            [clear_menu_item]
#                id=mod_add_village
#            [/clear_menu_item]
#            [clear_menu_item]
#                id=mod_remove_village
#            [/clear_menu_item]
#        [/event]
#    [/event]
#[/modification]

[modification]
    id=Mod_CaptureVillages
    name= _ "Mod Capture Villages"
    description= _ "A modification to capture all villages."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_capture_villages
            description= _ "Capture All Villages (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                [/have_unit]
            [/show_if]
            [command]
                [capture_village]
                    [filter_side]
                        [has_unit]
                            x,y=$x1,$y1
                        [/has_unit]
                    [/filter_side]
                    terrain=*^*
                    include_borders=no
                    fire_event=yes
                [/capture_village]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_capture_villages
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_PoisonUnit
    name= _ "Mod Poison Unit"
    description= _ "A modification to poison units."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_poison_unit
            description= _ "Poison Unit (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    [and]
                        [not]
                            status=poisoned
                        [/not]
                    [/and]
                [/have_unit]
            [/show_if]
            [command]
                [modify_unit]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    [effect]
                        apply_to=status
                        add=poisoned
                    [/effect]
                [/modify_unit]
                #[harm_unit]
                #    [filter]
                #        x,y=$x1,$y1
                #    [/filter]
                #    amount=0
                #    kill=no
                #    animate=no
                #    experience=no
                #    fire_event=no
                #    poisoned=yes
                #[/harm_unit]
                #[clear_variable]
                #    name=harm_amount
                #[/clear_variable]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_poison_unit
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_Extra_AMLA
    name= _ "Mod Extra AMLA"
    description= _ "A modification to give extra AMLAs."
    require_modification=no
    type=hybrid

    [event]
        name=start
        id=mod_extra_amla_start

        [store_unit]
            [filter]
                [filter_side]
                    controller=human
                [/filter_side]
                [filter_wml]
                    advances_to=""
                [/filter_wml]
            [/filter]
            variable=mod_amla_units
            kill=no
            mode=always_clear
        [/store_unit]
        [foreach]
            array=mod_amla_units
            [do]
                [fire_event]
                    name=mod_extra_amla
                    [primary_unit]
                        id=$this_item.id
                    [/primary_unit]
                [/fire_event]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE mod_amla_units}
    [/event]

    [event]
        name=post advance,recruit,recall,mod_extra_amla
        id=mod_extra_amla
        first_time_only=no

        [filter]
            [filter_side]
                controller=human
            [/filter_side]
            [filter_wml]
                advances_to=""
            [/filter_wml]
        [/filter]

        {VARIABLE remove_loyal no}
        {VARIABLE has_loyal no}
        {VARIABLE has_damage no}
        {VARIABLE has_strike no}
        {VARIABLE has_movement no}
        {VARIABLE has_resistance no}

        [if]
            {VARIABLE_CONDITIONAL unit.upkeep equals loyal}
            [then]
                {VARIABLE remove_loyal yes}
            [/then]
        [/if]

        [if]
            {VARIABLE_CONDITIONAL unit.upkeep equals free}
            [then]
                {VARIABLE remove_loyal yes}
            [/then]
        [/if]

        [if]
            {VARIABLE_CONDITIONAL unit.canrecruit equals yes}
            [then]
                {VARIABLE remove_loyal yes}
            [/then]
        [/if]

        [for]
            array=unit.modifications.advancement
            [do]
                [if]
                    {VARIABLE_CONDITIONAL unit.modifications.advancement[$i].id equals amla_loyal_mod}
                    [then]
                        {VARIABLE remove_loyal no}
                    [/then]
                [/if]
            [/do]
        [/for]

        [for]
            array=unit.advancement
            [do]
                [if]
                    {VARIABLE_CONDITIONAL unit.advancement[$i].id equals amla_loyal_mod}
                    [then]
                        {VARIABLE has_loyal yes}
                    [/then]
                [/if]
                [if]
                    {VARIABLE_CONDITIONAL unit.advancement[$i].id equals amla_damage_mod}
                    [then]
                        {VARIABLE has_damage yes}
                    [/then]
                [/if]
                [if]
                    {VARIABLE_CONDITIONAL unit.advancement[$i].id equals amla_strike_mod}
                    [then]
                        {VARIABLE has_strike yes}
                    [/then]
                [/if]
                [if]
                    {VARIABLE_CONDITIONAL unit.advancement[$i].id equals amla_movement_mod}
                    [then]
                        {VARIABLE has_movement yes}
                    [/then]
                [/if]
                [if]
                    {VARIABLE_CONDITIONAL unit.advancement[$i].id equals amla_resistance_mod}
                    [then]
                        {VARIABLE has_resistance yes}
                    [/then]
                [/if]
            [/do]
        [/for]

        [if]
            {VARIABLE_CONDITIONAL has_loyal equals no}
            {VARIABLE_CONDITIONAL remove_loyal equals no}
            [then]
                #insert loyal
                [object]
                    [effect]
                        apply_to=new_advancement
                        [advancement]
                            strict_amla=yes
                            max_times=1
                            id=amla_loyal_mod
                            description= _ "Loyal, Max HP bonus +3 (Mod)"
                            image="icons/amla-default.png"
                            #require_amla=amla_default
                            [effect]
                                apply_to=loyal
                            [/effect]
                            [effect]
                                apply_to=overlay
                                add="misc/loyal-icon.png"
                            [/effect]
                            [effect]
                                apply_to=hitpoints
                                increase_total=3
                                heal_full=yes
                            [/effect]
                            #[effect]
                            #    apply_to=max_experience
                            #    increase=20%
                            #[/effect]
                            [effect]
                                apply_to=status
                                remove=poisoned
                            [/effect]
                            [effect]
                                apply_to=status
                                remove=slowed
                            [/effect]
                        [/advancement]
                    [/effect]
                [/object]
            [/then]
        [/if]
        [if]
            {VARIABLE_CONDITIONAL has_damage equals no}
            [then]
                #insert damage
                [object]
                    [effect]
                        apply_to=new_advancement
                        [advancement]
                            strict_amla=yes
                            max_times=100
                            id=amla_damage_mod
                            description= _ "+1 Damage, Max HP bonus +3 (Mod)"
                            image="icons/amla-default.png"
                            #require_amla=amla_default
                            [effect]
                                apply_to=attack
                                increase_damage=1
                            [/effect]
                            [effect]
                                apply_to=hitpoints
                                increase_total=3
                                heal_full=yes
                            [/effect]
                            #[effect]
                            #    apply_to=max_experience
                            #    increase=20%
                            #[/effect]
                            [effect]
                                apply_to=status
                                remove=poisoned
                            [/effect]
                            [effect]
                                apply_to=status
                                remove=slowed
                            [/effect]
                        [/advancement]
                    [/effect]
                [/object]
            [/then]
        [/if]
        [if]
            {VARIABLE_CONDITIONAL has_strike equals no}
            [then]
                #insert strike
                [object]
                    [effect]
                        apply_to=new_advancement
                        [advancement]
                            strict_amla=yes
                            max_times=100
                            id=amla_strike_mod
                            description= _ "+1 Strike, Max HP bonus +3 (Mod)"
                            image="icons/amla-default.png"
                            #require_amla=amla_default
                            [effect]
                                apply_to=attack
                                increase_attacks=1
                            [/effect]
                            [effect]
                                apply_to=hitpoints
                                increase_total=3
                                heal_full=yes
                            [/effect]
                            #[effect]
                            #    apply_to=max_experience
                            #    increase=20%
                            #[/effect]
                            [effect]
                                apply_to=status
                                remove=poisoned
                            [/effect]
                            [effect]
                                apply_to=status
                                remove=slowed
                            [/effect]
                        [/advancement]
                    [/effect]
                [/object]
            [/then]
        [/if]
        [if]
            {VARIABLE_CONDITIONAL has_movement equals no}
            [then]
                #insert movement
                [object]
                    [effect]
                        apply_to=new_advancement
                        [advancement]
                            strict_amla=yes
                            max_times=100
                            id=amla_movement_mod
                            description= _ "+1 Movement, Max HP bonus +3 (Mod)"
                            image="icons/amla-default.png"
                            #require_amla=amla_default
                            [effect]
                                apply_to=movement
                                increase=1
                            [/effect]
                            [effect]
                                apply_to=hitpoints
                                increase_total=3
                                heal_full=yes
                            [/effect]
                            #[effect]
                            #    apply_to=max_experience
                            #    increase=20%
                            #[/effect]
                            [effect]
                                apply_to=status
                                remove=poisoned
                            [/effect]
                            [effect]
                                apply_to=status
                                remove=slowed
                            [/effect]
                        [/advancement]
                    [/effect]
                [/object]
            [/then]
        [/if]
        [if]
            {VARIABLE_CONDITIONAL has_resistance equals no}
            [then]
                #insert resistance
                [object]
                    [effect]
                        apply_to=new_advancement
                        [advancement]
                            strict_amla=yes
                            max_times=20
                            id=amla_resistance_mod
                            description= _ "+10 Resistance, Max HP bonus +3 (Mod)"
                            image="icons/amla-default.png"
                            #require_amla=amla_default
                            [effect]
                                apply_to=resistance
                                replace=no
                                [resistance]
                                    blade=-10
                                    pierce=-10
                                    impact=-10
                                    fire=-10
                                    cold=-10
                                    arcane=-10
                                [/resistance]
                            [/effect]
                            [effect]
                                apply_to=hitpoints
                                increase_total=3
                                heal_full=yes
                            [/effect]
                            #[effect]
                            #    apply_to=max_experience
                            #    increase=20%
                            #[/effect]
                            [effect]
                                apply_to=status
                                remove=poisoned
                            [/effect]
                            [effect]
                                apply_to=status
                                remove=slowed
                            [/effect]
                        [/advancement]
                    [/effect]
                [/object]
            [/then]
        [/if]

        [if]
            {VARIABLE_CONDITIONAL remove_loyal equals yes}
            [then]
                {VARIABLE do_remove_loyal no}
                [for]
                    array=unit.advancement
                    reverse=yes
                    [do]
                        [if]
                            {VARIABLE_CONDITIONAL unit.advancement[$i].id equals amla_loyal_mod}
                            [then]
                                {VARIABLE do_remove_loyal yes}
                                #{CLEAR_VARIABLE unit.advancement[$i]}
                            [/then]
                        [/if]
                    [/do]
                [/for]
                [if]
                    {VARIABLE_CONDITIONAL do_remove_loyal boolean_equals yes}
                    [then]
                        [object]
                            [effect]
                                apply_to=remove_advancement
                                amlas=amla_loyal_mod
                            [/effect]
                        [/object]
                    [/then]
                [/if]
                {CLEAR_VARIABLE do_remove_loyal}
            [/then]
        [/if]

        {CLEAR_VARIABLE remove_loyal}
        {CLEAR_VARIABLE has_loyal}
        {CLEAR_VARIABLE has_damage}
        {CLEAR_VARIABLE has_strike}
        {CLEAR_VARIABLE has_movement}
        {CLEAR_VARIABLE has_resistance}
    [/event]
[/modification]

[modification]
    id=Move_Teleport_Unit
    name= _ "Mod Move/Teleport Unit"
    description= _ "A modification to move or teleport a unit."
    require_modification=no
    type=hybrid

    [event]
        name=select
        first_time_only=no
        [filter]
            x,y=$x1,$y1
            [not]
                id=$hhu.debbie_move[0].id
            [/not]
            [filter_side]
                controller=human
            [/filter_side]
        [/filter]
        [store_unit]
            [filter]
                x,y=$x1,$y1
                id=$unit.id
            [/filter]
            mode=always_clear
            variable=hhu.debbie_move
        [/store_unit]
    [/event]

    [event]
        name=turn refresh
        first_time_only=yes

        [store_unit]
            [filter]
                [filter_side]
                    controller=human
                [/filter_side]
            [/filter]
            mode=always_clear
            variable=hhu.debbie_move
        [/store_unit]
        [set_menu_item]
            id=debbie_mt_menu
            description= _ "Select Moving Unit (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                    [not]
                        id=$hhu.debbie_move[0].id
                    [/not]
                [/have_unit]
            [/show_if]
            [command]
                [store_unit]
                    [filter]
                        x,y=$x1,$y1
                        id=$unit.id
                    [/filter]
                    mode=always_clear
                    variable=hhu.debbie_move
                [/store_unit]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=debbie_move_menu
            description= _ "Move here (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
                [have_unit]
                    id=$hhu.debbie_move[0].id
                    count=1
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                [move_unit]
                    id=$hhu.debbie_move[0].id
                    to_x=$x1
                    to_y=$y1
                    check_passability=no
                    fire_event=yes
                [/move_unit]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=debbie_teleport_menu
            description= _ "Teleport here (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
                [have_unit]
                    id=$hhu.debbie_move[0].id
                    count=1
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                [teleport]
                    [filter]
                        id=$hhu.debbie_move[0].id
                    [/filter]
                    x=$x1
                    y=$y1
                    check_passability=no
                    clear_shroud=yes
                    animate=yes
                    fire_event=yes
                [/teleport]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_variable]
                name=hhu.debbie_move
            [/clear_variable]
            [clear_menu_item]
                id=debbie_mt_menu
            [/clear_menu_item]
            [clear_menu_item]
                id=debbie_move_menu
            [/clear_menu_item]
            [clear_menu_item]
                id=debbie_teleport_menu
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_AdvanceUnit
    name= _ "Mod Advance Unit"
    description= _ "A modification to advance units."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_advance_unit
            description= _ "Advance Unit (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                [/have_unit]
            [/show_if]
            [command]
                [modify_unit]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    #experience = "$($unit.max_experience)"
                    [effect]
                        apply_to=experience
                        #set="$($unit.max_experience)"
                        increase="$($unit.max_experience - $unit.experience)"
                    [/effect]
                [/modify_unit]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_advance_unit
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_Toggle_HP
    name= _ "Mod Toggle HP"
    description= _ "A modification to toggle the units HP."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_toggle_hp
            description= _ "Toggle HP (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                [if]
                    [have_unit]
                        x,y=$x1,$y1
                        count=1
                        search_recall_list=no
                        [and]
                            [filter_wml]
                                hitpoints=$this_unit.max_hitpoints
                            [/filter_wml]
                        [/and]
                    [/have_unit]
                    [then]
                        [if]
                            [variable]
                                name=unit.hitpoints
                                greater_than=1
                            [/variable]
                            [then]
                                [set_variable]
                                    name=unit.hitpoints
                                    sub=1
                                [/set_variable]
                            [/then]
                        [/if]
                        [harm_unit]
                            [filter]
                                x,y=$x1,$y1
                                id=$unit.id
                            [/filter]
                            amount=$unit.hitpoints
                            kill=no
                            animate=yes
                            experience=no
                            fire_event=no
                        [/harm_unit]
                        [clear_variable]
                            name=harm_amount
                        [/clear_variable]
                    [/then]
                    [else]
                        [heal_unit]
                            [filter]
                                x,y=$x1,$y1
                                id=$unit.id
                            [/filter]
                            amount=full
                            restore_attacks=no
                            restore_statuses=no
                            animate=yes
                        [/heal_unit]
                        [clear_variable]
                            name=heal_amount
                        [/clear_variable]
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_toggle_hp
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_Freeze_Thaw
    name= _ "Mod Freeze/Thaw unit"
    description= _ "A modification to freeze units."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_freeze
            description= _ "Freeze unit (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                    [not]
                        status=mod_frozen
                    [/not]
                    [filter_side]
                        controller=ai
                    [/filter_side]
                    movement_cost=1-49
                [/have_unit]
            [/show_if]
            [command]
                [modify_unit]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    [status]
                        mod_frozen=yes
                    [/status]
                [/modify_unit]
                [object]
                    id=mod_freezer
                    take_only_once=no
                    silent=yes
                    duration=scenario
                    [filter]
                        x,y=$x1,$y1
                        movement_cost=1-49
                    [/filter]
                    [effect]
                        apply_to=movement_costs
                        replace=no
                        [movement_costs]
                            frozen=50
                            castle=50
                            sand=50
                            forest=50
                            flat=50
                            hills=50
                            mountains=50
                            unwalkable=50
                            swamp_water=50
                            fungus=50
                            cave=50
                            village=50
                            deep_water=50
                            reef=50
                            shallow_water=50
                            impassable=50
                        [/movement_costs]
                    [/effect]
                [/object]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=mod_thaw
            description= _ "Thaw unit (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                    status=mod_frozen
                [/have_unit]
            [/show_if]
            [command]
                [modify_unit]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    [status]
                        mod_frozen=no
                    [/status]
                [/modify_unit]
                [remove_object]
                    x,y=$x1,$y1
                    object_id=mod_freezer
                [/remove_object]
            [/command]
        [/set_menu_item]

        [set_menu_item]
            id=mod_freeze_side
            description= _ "Freeze side (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                    [not]
                        status=mod_frozen
                    [/not]
                    [filter_side]
                        controller=ai
                    [/filter_side]
                    movement_cost=1-49
                [/have_unit]
            [/show_if]
            [command]
                [modify_unit]
                    [filter]
                        side=$unit.side
                        [not]
                            status=mod_frozen
                        [/not]
                    [/filter]
                    [object]
                        id=mod_freezer
                        take_only_once=no
                        silent=yes
                        duration=scenario
                        [filter]
                            movement_cost=1-49
                        [/filter]
                        [effect]
                            apply_to=movement_costs
                            replace=no
                            [movement_costs]
                                frozen=50
                                castle=50
                                sand=50
                                forest=50
                                flat=50
                                hills=50
                                mountains=50
                                unwalkable=50
                                swamp_water=50
                                fungus=50
                                cave=50
                                village=50
                                deep_water=50
                                reef=50
                                shallow_water=50
                                impassable=50
                            [/movement_costs]
                        [/effect]
                    [/object]
                [/modify_unit]
                [modify_unit]
                    [filter]
                        side=$unit.side
                        [not]
                            status=mod_frozen
                        [/not]
                    [/filter]
                    [status]
                        mod_frozen=yes
                    [/status]
                [/modify_unit]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=mod_thaw_side
            description= _ "Thaw side (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                    count=1
                    search_recall_list=no
                    status=mod_frozen
                [/have_unit]
            [/show_if]
            [command]
                [modify_unit]
                    [filter]
                        side=$unit.side
                        status=mod_frozen
                    [/filter]
                    [status]
                        mod_frozen=no
                    [/status]
                [/modify_unit]
                [remove_object]
                    side=$unit.side
                    object_id=mod_freezer
                [/remove_object]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_freeze
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_thaw
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_freeze_side
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_thaw_side
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_Keep_Alive
    name= _ "Mod Keep Alive"
    description= _ "A modification to keep the human side alive."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [set_menu_item]
            id=mod_keepalive_on
            description= _ "Turn On Keep Alive (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [not]
                    {VARIABLE_CONDITIONAL mod_keepalive numerical_equals 1}
                [/not]
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE mod_keepalive 1}
                [event]
                    id=mod_keepalive_event_primary
                    name=attack end
                    first_time_only=no
                    delayed_variable_substitution=yes
                    [filter]
                        [filter_side]
                            controller=human
                        [/filter_side]
                    [/filter]
                    [filter_second]
                        [filter_side]
                            controller=ai
                        [/filter_side]
                    [/filter_second]
                    [if]
                        {VARIABLE_CONDITIONAL unit.hitpoints less_than 1}
                        [then]
                            {MODIFY_UNIT id=$unit.id hitpoints 1}
                        [/then]
                    [/if]
                [/event]
                [event]
                    id=mod_keepalive_event_secondary
                    name=attack end
                    first_time_only=no
                    delayed_variable_substitution=yes
                    [filter]
                        [filter_side]
                            controller=ai
                        [/filter_side]
                    [/filter]
                    [filter_second]
                        [filter_side]
                            controller=human
                        [/filter_side]
                    [/filter_second]
                    [if]
                        {VARIABLE_CONDITIONAL second_unit.hitpoints less_than 1}
                        [then]
                            {MODIFY_UNIT id=$second_unit.id hitpoints 1}
                        [/then]
                    [/if]
                [/event]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=mod_keepalive_off
            description= _ "Turn Off Keep Alive (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                {VARIABLE_CONDITIONAL mod_keepalive numerical_equals 1}
                [have_unit]
                    x,y=$x1,$y1
                    count=0
                    search_recall_list=no
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE mod_keepalive 0}
                [remove_event]
                    id=mod_keepalive_event_primary
                [/remove_event]
                [remove_event]
                    id=mod_keepalive_event_secondary
                [/remove_event]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_variable]
                name=mod_keepalive
            [/clear_variable]
            [clear_menu_item]
                id=mod_keepalive_on
            [/clear_menu_item]
            [clear_menu_item]
                id=mod_keepalive_off
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

## Doesn't work
#[modification]
#    id=Mod_Fire_Moveto
#    name= _ "Mod Fire Moveto"
#    description= _ "A modification to fire all moveto events."
#    require_modification=no
#    type=hybrid
#
#    [event]
#        name=prestart
#
#        [set_menu_item]
#            id=mod_fire_moveto
#            description= _ "Fire moveto (Mod)"
#            image=misc/blank-hex.png~SCALE(1,1)
#            [show_if]
#                [have_unit]
#                    x,y=$x1,$y1
#                    search_recall_list=no
#                [/have_unit]
#            [/show_if]
#            [command]
#                [store_unit]
#                    [filter]
#                        x,y=$x1,$y1
#                        id=$unit.id
#                    [/filter]
#                    mode=always_clear
#                    variable=debbie_actor_moveto
#                [/store_unit]
#                [store_locations]
#                    variable=debbie_locations
#                    {EVERYWHERE}
#                    include_borders=no
#                [/store_locations]
#                [for]
#                    array=debbie_locations
#                    [do]
#                        [fire_event]
#                            name=moveto
#                            [primary_unit]
#                                id=$debbie_actor_moveto[0].id
#                                x=$debbie_locations[$i].x
#                                y=$debbie_locations[$i].y
#                            [/primary_unit]
#                        [/fire_event]
#                    [/do]
#                [/for]
#                [clear_variable]
#                    name=debbie_actor_moveto
#                [/clear_variable]
#                [clear_variable]
#                    name=debbie_locations
#                [/clear_variable]
#            [/command]
#        [/set_menu_item]
#
#        [event]
#            name=scenario_end
#            [clear_menu_item]
#                id=mod_fire_moveto
#            [/clear_menu_item]
#            [clear_variable]
#                name=debbie_actor_moveto
#            [/clear_variable]
#            [clear_variable]
#                name=debbie_locations
#            [/clear_variable]
#        [/event]
#    [/event]
#[/modification]

[modification]
    id=Mod_DumpUnit
    name= _ "Mod Dump Unit"
    description= _ "A modification to dump unit information."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [lua]
            code=<<
--std_print("wesnoth.scenario.id = " .. wesnoth.scenario.id)
std_print("wesnoth.game_config.scenario_id = " .. wesnoth.game_config.scenario_id)
>>
        [/lua]

        [set_menu_item]
            id=mod_dumpunit
            description= _ "Dump unit (Mod)"
            image=misc/blank-hex.png~SCALE(1,1)
            [show_if]
                [have_unit]
                    x,y=$x1,$y1
                [/have_unit]
            [/show_if]
            [command]
                [lua]
                    code= <<
local function hhu_w_pt(node)
    if type(node) ~= "table" then
        if type(node) == "boolean" or type(node) == "number" or type(node) == "string" then
            std_print("w_pt Type = " .. type(node) .. ". Value = " .. node)
        else
            std_print("w_pt Type = " .. type(node) .. ".")
        end
        return
    end

    local cache, stack, output = {},{},{}
    local depth = 1
    local output_str = "{\n"

    while true do
        local size = 0
        for k,v in pairs(node) do
            size = size + 1
        end

        local cur_index = 1
        for k,v in pairs(node) do
            if (cache[node] == nil) or (cur_index >= cache[node]) then

                if (string.find(output_str,"}",output_str:len())) then
                    output_str = output_str .. ",\n"
                elseif not (string.find(output_str,"\n",output_str:len())) then
                    output_str = output_str .. "\n"
                end

                -- This is necessary for working with HUGE tables otherwise we run out of memory using concat on huge strings
                table.insert(output,output_str)
                output_str = ""

                local key
                if (type(k) == "number" or type(k) == "boolean") then
                    key = "["..tostring(k).."]"
                else
                    key = "['"..tostring(k).."']"
                end

                if (type(v) == "number" or type(v) == "boolean") then
                    output_str = output_str .. string.rep('    ',depth) .. key .. " = "..tostring(v)
                elseif (type(v) == "table") then
                    output_str = output_str .. string.rep('    ',depth) .. key .. " = {\n"
                    table.insert(stack,node)
                    table.insert(stack,v)
                    cache[node] = cur_index+1
                    break
                else
                    output_str = output_str .. string.rep('    ',depth) .. key .. " = '"..tostring(v).."'"
                end

                if (cur_index == size) then
                    output_str = output_str .. "\n" .. string.rep('    ',depth-1) .. "}"
                else
                    output_str = output_str .. ","
                end
            else
                -- close the table
                if (cur_index == size) then
                    output_str = output_str .. "\n" .. string.rep('    ',depth-1) .. "}"
                end
            end

            cur_index = cur_index + 1
        end

        if (size == 0) then
            output_str = output_str .. "\n" .. string.rep('    ',depth-1) .. "}"
        end

        if (#stack > 0) then
            node = stack[#stack]
            stack[#stack] = nil
            depth = cache[node] == nil and depth + 1 or depth - 1
        else
            break
        end
    end

    -- This is necessary for working with HUGE tables otherwise we run out of memory using concat on huge strings
    table.insert(output,output_str)
    output_str = table.concat(output)

    --print(output_str)
    std_print(output_str)
end

local u = wesnoth.get_unit( wesnoth.current.event_context.x1, wesnoth.current.event_context.y1 )
std_print("Start unit dump: " .. u.id)
hhu_w_pt(u.__cfg)
std_print("End unit dump: " .. u.id)
>>
                [/lua]
            [/command]
        [/set_menu_item]

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_dumpunit
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]

[modification]
    id=Mod_Side_Switch
    name= _ "Mod Switch Side"
    description= _ "A modification to switch unit side."
    require_modification=no
    type=hybrid

    [event]
        name=prestart

        [store_side]
            controller=human
            variable=hhu_sides
        [/store_side]
        [if]
            {VARIABLE_CONDITIONAL hhu_sides.length greater_than 1}
            [then]
                [set_menu_item]
                    id=mod_switch_side
                    description= _ "Switch side (Mod)"
                    image=misc/blank-hex.png~SCALE(1,1)
                    [show_if]
                        [have_unit]
                            x,y=$x1,$y1
                            [filter_side]
                                controller=human
                            [/filter_side]
                        [/have_unit]
                    [/show_if]
                    [command]
                        [store_side]
                            controller=human
                            variable=hhu_sides
                        [/store_side]
                        {VARIABLE new_side $unit.side}
                        {VARIABLE_OP new_side modulo $hhu_sides.length}
                        {VARIABLE_OP new_side add 1}
                        {MODIFY_UNIT (id=$unit.id) side $new_side}
                        {CLEAR_VARIABLE new_side}
                        {CLEAR_VARIABLE hhu_sides}
                    [/command]
                [/set_menu_item]
            [/then]
        [/if]
        {CLEAR_VARIABLE hhu_sides}

        [event]
            name=scenario_end
            [clear_menu_item]
                id=mod_switch_side
            [/clear_menu_item]
        [/event]
    [/event]
[/modification]
